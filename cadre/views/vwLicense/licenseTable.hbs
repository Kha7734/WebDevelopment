<div style="width:80%; margin: 50px auto">
<div>
    <div class="d-flex" style="width: 50%">
    <select id ='ward' class="form-select" disabled>
        <option value="">Chọn phường</option>
    </select>



    <select id ='district' class="form-select ml-3" value="Chọn quận">
        <option value="">Chọn quận</option>
        {{#each districts}}
            <option value="{{_id}}">{{district}}</option>
        {{/each}}
    </select>


    <script>
        var wards = JSON.parse('{{{wards}}}');
        document.getElementById('district').addEventListener('change', (e) =>{
            let districtId = e.target.value
            if (!districtId)
            {
                document.getElementById('ward').disabled = true
                return
            }
            let wardSelect = document.getElementById('ward')

            wardSelect.innerHTML = '<option value="">Chọn phường</option>'
            wards.forEach(ward => {
                if (ward.district == districtId)
                {
                    let option = document.createElement('option')
                    option.value = ward._id
                    option.innerText = ward.ward
                    wardSelect.appendChild(option)
                }

            })
            wardSelect.disabled = false

        })
    </script>
    </div>
    <script>

    </script>
</div>
<table id="license-table" class="table table-striped">
        <thead>
            <tr>
                <th>Nơi xin cấp phép</th>
                <th>Công ty xin cấp</th>
                <th>Ngày bắt đầu</th>
                <th>Ngày kết thúc</th>
                <th>Ngày tạo</th>
                <th>Tình trạng</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {{#each license}}
            <tr data-id="{{{_id}}}">
                <td>
                    {{board.boardLocation.addr}}
                </td>
                <td>
                    {{company.infor}}
                </td>
                <td>
                    {{period.start_date}}  
                </td>
                <td>
                    {{period.end_date}}
                </td>
                <td>
                    {{createAt}}
                </td>
                <td>
                    {{#if this.status}}
                        <span class="badge bg-success">Đã duyệt</span>
                    {{else}}
                        <span class="badge bg-warning">Chưa duyệt</span>
                    {{/if}}
                </td>
                <td>
                    <a href="/license?id={{_id}}" class="table-link btn btn-primary">
                        <i class="bi bi-search"></i>
                    </a>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>

{{#section 'footer'}}
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const socket = io('http://localhost:4000')
        socket.on('update status', (data) =>{
            console.log(data);
            document.querySelectorAll('#license-table tbody tr').forEach(tr =>{
                if (tr.dataset.id == data.id && data.status == true)
                {
                    console.log(tr);
                    tr.querySelector('td:nth-child(6)').innerHTML = '<span class="badge bg-success">Đã duyệt</span>'
                }
            })
        })
    </script>
{{/section}}

